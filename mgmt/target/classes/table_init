-- 创建数据库
CREATE DATABASE IF NOT EXISTS management_system DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE management_system;

-- 角色表
CREATE TABLE IF NOT EXISTS role (
    role_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '角色ID',
    role_name VARCHAR(50) NOT NULL COMMENT '角色名',
    role_type VARCHAR(20) NOT NULL COMMENT '角色类型（管理员、调解员）',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_role_name (role_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';

-- 用户表
CREATE TABLE IF NOT EXISTS user (
    user_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    role_id BIGINT NOT NULL COMMENT '关联角色ID',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_username (username),
    KEY idx_role_id (role_id),
    CONSTRAINT fk_user_role FOREIGN KEY (role_id) REFERENCES role (role_id) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';

-- 任务表
CREATE TABLE IF NOT EXISTS task (
    task_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '任务ID',
    task_name VARCHAR(100) NOT NULL COMMENT '任务名',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_task_name (task_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='任务表';

-- 案件表
CREATE TABLE IF NOT EXISTS case_info (
    case_id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '案件ID',
    case_number VARCHAR(50) NOT NULL COMMENT '案件号',
    case_name VARCHAR(100) NOT NULL COMMENT '案由',
    task_id BIGINT COMMENT '绑定的任务ID',
    status VARCHAR(20) NOT NULL COMMENT '案件状态：待发布->待领取->已领取->已完成',
    user_id BIGINT COMMENT '案件绑定用户ID',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_case_number (case_number),
    KEY idx_task_id (task_id),
    KEY idx_user_id (user_id),
    KEY idx_status (status),
    CONSTRAINT fk_case_task FOREIGN KEY (task_id) REFERENCES task (task_id) ON DELETE SET NULL,
    CONSTRAINT fk_case_user FOREIGN KEY (user_id) REFERENCES user (user_id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='案件表';

-- 初始化角色数据
INSERT INTO role (role_name, role_type) VALUES
('系统管理员', '管理员'),
('初级调解员', '调解员'),
('高级调解员', '调解员');